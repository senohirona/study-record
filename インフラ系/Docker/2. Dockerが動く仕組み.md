# Dockerが動く仕組み

## Dockerの仕組み
物理マシンがあるとすると、その物理マシンの上にLinuxOSがある。
ここまでは普通のサーバーと同じ。
普通のサーバーであれば、OSの上にプログラムやデータを直接乗せるのだが、Dockerを使いたい場合は、OSの上にDocker Engineを載せ、その上でコンテナを動かす。
プログラムやデータはコンテナの中に入れる。

## コンテナの中にはOSっぽいものが入っている
では、コンテナの中はどうなっているのかというと、コンテナの中には必ず「OSっぽいもの」が入っている。
(居酒屋で言うお通しみたいなもの)
っぽいものであり、完全なOSではない。
これは、OSについての話も関連してくる。

OSはそもそも「カーネル」という核になる部分とその「周辺」の部分で構成されている。
周辺の部分がプログラムからの連絡を受け取ってカーネルに伝え、カーネルがハードウェアを操作する。
Dockerの場合、コンテナは完全に分離されているので、土台となるLinuxOSの周辺部分がコンテナの中にあるプログラムの命令を受け取ることが出来ない。
そのため、コンテナの中にOSの周辺部分を入れてプログラムの命令を受け取り、受け取った命令を土台のカーネルに伝える仕組みになっている。
このような理由でコンテナの中には、最小限「Linuxぽいもの」が入っており、LinuxOSまるごとではなく周辺部分しか入っていないので「ぽいもの」という曖昧な言い回しになる。

# Docker Hubとイメージとコンテナ

## イメージとコンテナ
コンテナを作成するときはイメージから作成する。
イメージはコンテナの作成の素となるもので、コンテナを作るための設計図のようなもの。

# Docker Hubとイメージ
コンテナのイメージは、初心者が１から作ることはめったにない。
大方の場合はDockerHubというとこからイメージを入手する。
Docker Hubは公式が運用しているDockerレジストリの名前で、誰でも簡単に利用できるのが特徴。
DockerHubは、スマホにおけるGoogle Playのように、配布されているコンテナイメージがたくさん集まっている場所。
そこから使用したいコンテナのイメージを取得する。
配布されるコンテナのイメージは、数多くの種類が用意されている。

## 安全なコンテナイメージの選び方
### 公式の提供しているイメージを使う
Docker公式やソフトウェアを作成・管理している企業や段階が提供しているイメージが有るので、もし利用するならそれを使うのが安全かつ手軽。
ただし、ソフトウェアの場合、コンテナの中のOS(っぽいもの)が特定OSん・バージョンに限っており、自由に選べるとは言い難いため、どうしても特定のOSやバージョンにしたいというこだわりがある場合は、注意が必要。

### 自分でカスタムする。
コンテナは自分でカスタマイズできるので、必要最低限の物が入ったコンテナを選択し、自分でソフトウェアをインストールするという手もある。
## 様々な組み合わせが考えられるコンテナ
コンテナは、選び方だけではなく、組み合わせ方も考える必要がある。
Dockerの特徴的な使い方の一つに、「1コンテナ=1アプリ」という考え方がある。
これは、1つのコンテナには1つのアプリしか入れないという意味で、セキュリティ面やメンテナンスのしやすさからこのような運用方法を選ぶことも多い。

例)WordPressを構築する場合
WordPress本体とApache(webサーバー用ソフト)、MySQL等のデータベース管理ソフトが必要になる。
Dockerでこれを降雨ちくする場合、これらをバラバラに入れても良いし、1つのコンテナに入れることもできる。

