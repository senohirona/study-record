# コンテナとホスト間でファイルをコピーする
ホストからコンテナの中にファイルをコピーしてみる
コピーには`docker cp`コマンドを利用する
cpコマンドはホスト→コンテナ、コンテナ→ホスト両方行える

```
docker cp コピー元パス コピー先のコンテナ名:コンテナ側パス
```

今回はApacheのコンテナにindex.htmlファイルをコピーして体験してみる

### 今回の流れ
1. Apacheコンテナの作成
2. コピー
3. 確認

### 事前準備
index.htmlファイルを作成する

## Apacheコンテナを作成する
以前イメージを削除したので、新しく入れ直している
```
$ docker run --name apa000ex19 -d -p 8089:80 httpd
Unable to find image 'httpd:latest' locally
latest: Pulling from library/httpd
7a6db449b51b: Pull complete
b4effd428409: Pull complete
6b29c2b62286: Pull complete
c2123effa3fc: Pull complete
152876b0d24a: Pull complete
Digest: sha256:f2d43eb0cd597cc6201e5078802f7df712750be5cf7f014bdff5b9dfb777f93d
Status: Downloaded newer image for httpd:latest
388dd5710b6414ccc58d491a190a2869cb56a0ff492f73cf91f8117259bd99d7
```

## ブラウザでApacheにアクセスして初期画面を確認する
まだhtmlを変更していないので初期画面のまま
![](./%E3%82%B9%E3%82%AF%E3%82%B7%E3%83%A7%E7%AD%89/apache%E3%81%A8%E3%83%9D%E3%83%BC%E3%83%88.png)

## cpコマンドを実行して、ホストからコンテナへファイルをコピーする
cpコマンドで、ホストからコンテナにindex.htmlファイルをコピーする
```
$ docker cp index.html apa000ex19:/usr/local/apache2/htdocs

```

## index.htmlに変わったことを確認する
変わっている
![](./%E3%82%B9%E3%82%AF%E3%82%B7%E3%83%A7%E7%AD%89/%E3%83%9B%E3%82%B9%E3%83%88%E3%81%8B%E3%82%89%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%B8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8B.png)

## コンテナからホストにファイルのコピーをしてみる
先ほどとは逆をする。

### 今回の流れ
1. Apacheコンテナの作成
2. コピー(コンテナ→ホスト)
3. 確認

## Apacheコンテナの作成
先ほど作成したコンテナをそのまま使う。

## cpコマンドを実行して、コンテナからホストへファイルをコピー
```
$ docker cp apa000ex19:/usr/local/apache2/htdocs/index.html /Users/<ユーザー名>/Documents/
```

## ホスト側にindex.htmlファイルがコピーされたことを確認する

## 後始末を行う
```
$ docker stop apa000ex19
apa000ex19

$ docker rm apa000ex19
apa000ex19
```

# ボリュームのマウント

## ボリュームとマウント
ボリューム: ストレージの1領域を区切ったもの。ハードディスクやSSDの区切られた1領域。長いカステラの1部のようなもの
マウント(「取り付ける」):対象を接続して、OSやソフトウェアの支配下に置くこと。USBをPCに挿して使うこともマウントと言う。

コンテナは「作っては壊す」という性質上、ソフトウェアのバージョンアップに伴って削除する日が来る。
こうしたときに、コンテナ内にデータを置いていると、コンテナと一緒にデータが消滅してしまう。
そのため、コンテナを作成する際に最初から外に保存して、そのままアクセスして使うのが一般的。
(↑を通称「ボリュームのマウント」とエンジニアはいっている)

## 記憶領域のマウントの種類
Dockerに記憶領域をマウントするには2種類の方法がある。

### ボリュームマウント
Dockerエンジンが管理している領域内にボリュームを作成し、ディスクとしてコンテナにマウントする。

<利点>
名前だけで管理ができるため、手軽に扱える

<難点>
ボリュームに対して直接操作しづらい
「仮で使いたい」場合や「めったに触らないが、消してはいけないファイル」を置くのに使うことが多い

### バインドマウント
Dockerをインストールしたパソコンのドキュメントやデスクトップなど、Dockerエンジンの管理していない場所の既に存在するディレクトリをコンテナにマウントする。
ディレクトリだけでなく、ファイル単位でマウントすることもできる。
フォルダ(ディレクトリ)に対して直接ファイルを置いたり開いたりできるため、頻繁に触りたいファイルはここに置く。

使い分けとしては
`ファイルを編集する事が多い場合は、バインドマウント、そうでない場合はボリュームマウント`を選ぶと良い。

|項目|ボリュームマウント|バインドマウント|
--|--|--
|記憶領域|ボリューム|ディレクトリやファイル|
|マウントの場所|Dockerエンジン管理下|どこでも可能|
|マウント時の動作|ボリュームを作成してマウント|既存のファイルやフォルダをマウント|
|内容の編集|Dockerコンテナを経由して行う|普通のファイルとして扱う|
|バックアップ|複雑な手順|普通のファイルとして扱う|


## 記憶領域をマウントする手順
記憶領域をマウントする場合、先にその記憶領域を作成しておく。
ボリュームマウントの場合は、作っておかなくてもマウント時にボリューム(記憶領域)が存在しなければ自動で作られっるが、この方法は推奨されていない点に注意。

### 手順
1. 記憶領域を作る
2. コンテナを作る(マウントする)

## バインドマウントをしてみる
今回もApacheコンテナを利用してバインドマウントをしてみる

### 今回の流れ
1. フォルダを作る
2.Apacheコンテナの作成
2. 初期ページを確認
3. index.htmlファイルを置く
4. 確認

## マウントするフォルダ/ディレクトリを作成する
マウントする予定のフォルダ/ディレクトリを「apa_folder」という名前で作成する。

```
mkdir apa_folder
```

## Apacheコンテナを起動する
```
$ docker run --name apa000ex20 -d -p 8090:80 -v /Users/<ユーザー名>/practice-docker/study-mount/apa_folder:/usr/local/apache2/htdocs httpd
80715f11206180b85be39868d2489576774248428fced5c973e58f11cf1fddf1
```

## ブラウザでApacheんにアクセスして初期画面を確認する
![](./%E3%82%B9%E3%82%AF%E3%82%B7%E3%83%A7%E7%AD%89/%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B.png)

## マウントしたフォルダ/ディレクトリにindex.htmlを置く
「apa_folder」の中に「index.html」ファイルを入れる。

## index.htmlに変わったことを確認する
![](./%E3%82%B9%E3%82%AF%E3%82%B7%E3%83%A7%E7%AD%89/%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B_2.png)

変わった

## 後始末を行う
いつものコンテナを片付ける

```
$ docker container stop apa000ex20
apa000ex20

$ docker container rm apa000ex20
apa000ex20
```
