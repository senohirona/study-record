#　使用すべきデータ パイプライン アーキテクチャとは

元記事

[使用すべきデータ パイプライン アーキテクチャとは | Google Cloud 公式ブログ](https://cloud.google.com/blog/ja/topics/developers-practitioners/what-data-pipeline-architecture-should-i-use)

# はじめに

データパイプラインは、データのライフサイクルの中でデータを処理する必要がある場合に定義する。

パイプラインは、データの生成と任意の形式での保存から開始される。そして、データの分析、ビジネス情報としての利用、データウェアハウスへの保存、機械学習モデルの処理で終了する。

データの抽出、処理、変換は、下流のシステム要件に応じて、複数のステップで行われる。

要件に応じて、パイプラインは 1 ステップのような単純なものだけでなく、複数の変換・処理ステップに及ぶ複雑なものになる場合もある。

# 設計パターンの選び方

データ パイプラインの設計パターンを選択する際、考慮する必要があるさまざまな設計要素がある。

その要素には次のようなものが含まれる。

- データソースの形式を選択する
- 使用するスタックを選択する
- データ変換ツールを選択する
- ETL,ELT,Extract Transform Load Transform（ETLT）のいずれかを選択する
- 変更されたデータの管理方法を決定する
- 変更を取り込む方法を決定する

データソースには様々なデータ型がある。

エンタープライズ環境では、変更されたデータを取り込んでターゲット データと結合するために、複数の複雑な手法を使用する必要があるという課題が伴う。

データフローの処理手順とシーケンスは、パイプラインの設計に影響を与える主な要因である。

各ステップには1つ以上のデータ入力が含まれる場合があり、出力には1つ以上のステージが含まれる場合がある。

入力から出力までの間の処理は、単純な変換ステップの場合もあれば、複雑な変換ステップになる場合もある。進行中のステップと変換を明確に理解できるように、設計をシンプルかつモジュール化することをおすすめする。また、パイプラインの設計をシンプルかつモジュール化することで、開発者チームは開発とデプロイのサイクルを実行しやすくなる。また、パイプラインに問題が発生した場合のデバッグやトラブルシューティングも容易になる。

パイプラインの主要なコンポーネントには次のものがある。

- ソースデータ
- 処理
- ターゲット ストレージ

ソースデータには、トランザクションアプリケーション、ユーザーから収集したファイル、外部APIから抽出したデータなどがある。

ソースデータの処理は、1ステップのコピーのような単純なものから、複数のデータ変換や他のデータソースとの結合と言った複雑なものまで、さまざまな物がある。

ターゲットのデータ ウェアハウジング システムでは、変換（データ型の変更やデータ抽出など）の結果である処理済みデータや、他のシステムからのルックアップと更新が必要になる場合がある。

ソースデータは複数の形式で提示できる。それぞれの形式に、処理と変換のための適切なアーキテクチャとツールが必要になる。

一般的なデータパイプラインでは、複数のデータ型が必要になる場合があり、次のいずれかの形式になる。

- バッチデータ:  表形式の情報ファイル(CSV等)で、定義済みのしきい値や頻度に従って、従来のバッチ処理またはマイクロバッチ処理によりデータが収集される。最近のアプリケーションは、連続するデータを生成する傾向がある。そのため、ソースからデータを収集する際には、マイクロバッチ処理が推奨される。
- トランザクションデータ: RDBMS、NoSQL、ビッグデータなどのアプリケーションデータ
- ストリーミングデータ: kafka, Pub/Sub等を使用するリアルタイムアプリケーション。
- フラットファイル: 処理用のデータを含むPDFやその他の非表形式のファイル。

ターゲットデータは、要件と下流の処理ニーズに基づいて定義される。

複数のシステムのニーズを満たすために、ターゲットデータを構築するのが一般的。データレイクのコンセプトでは、分析システムが分析情報を得られるようにデータを処理・保存しつつ、AI/MLプロセスでそのデータを使用して予測モデルを構築できるようにする。

# アーキテクチャと例

ソースデータがどのように抽出され、ターゲットに変換されるかを示す複数のアーキテクチャ設計について説明する。

データパイプラインアーキテクチャは、論理レベルとプラットフォームレベルに分解できる。論理設計では、データがどのように処理され、ソースからターゲットに変換されるかを記述する。

プラットフォーム設計では、各環境に必要な実装やツールに焦点を当てるが、プラットフォームで利用可能なプロバイダやツールに依存することになる。

以下は、データウェアハウジングパイプラインの論理設計。

下流の要件に応じて、一般的なアーキテクチャ設計をより詳細に実装して、いくつかのユースケースに対応することが可能。

プラットフォームの実装は、ツールセットの選択と開発スキルによって異なる場合がある。

# データ パイプライン アーキテクチャの選択方法

データパイプラインの設計と実装には、複数のアプローチがある。

重要なのは、要件を満たす設計を選択すること。

適切なデータパイプラインアーキテクチャを決定する際のもう一つの大きな要因は、費用。

費用対効果の高いソリューションを構築することが、設計を決定する大きなポイントになる。通常、ストリーミングパイプラインやリアルタイムのデータ処理パイプラインは、バッチモデルを使用する場合と比べて構築や実行にかかる費用が高くなる。

どの設計を選択するか、どのようにプラットフォームを構築するかは、予算によって決まる場合もある。

各コンポーネントの詳細を把握し、事前にソリューションのコスト分析ができることは、ソリューションに適したアーキテクチャ設計を選択する上で重要。

本当にリアルタイム分析が必要なのか、それともリアルタイムのシステムで十分なのか。これによりストリーミングパイプラインの設計が決まる。クラウドネイティブのソリューションを構築するのか、それとも既存のソリューションをオンプレミスから移行するのか。これらの問題は全て、データパイプラインの適切なアーキテクチャを設計する上で重要。

データパイプラインを設計する際は、データ量も無視できない。ソリューションの設計と実装においては、プラットフォームで使用される設計とサービスのスケーラビリティも非常に重要な要素になる。

データの量や速度、あるいはデータの流量は、非常に重要な要素になる場合がある。